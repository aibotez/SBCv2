<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>小黑云</title>

    <style>
        tr.change:hover
        {
            background-color:#DCDCDC;
            opacity:0.5;
            width:100%;
        }

        .div
        {
            position:fixed;
            width: 100%;
            height: 100%;
        }
       .div2
          {
            color: black;
            width: 79%;
            height: 100%;
            border:1px solid #0ba;
            float:left;
          }
        .div1
            {
               background-color: #ADADAD;
               color: red;
               width: 20%;
               height: 100%;
               border:1px solid #0ba;
               float:left;
            }

        .container {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }
    </style>

<!--<script src="https://upcdn.b0.upaiyun.com/libs/jquery/jquery-2.0.2.min.js"></script>-->
    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>

</head>
<body>

<div class="div" id="div">

    <div class="div1" id="div1">

    </div>

    <div style="height:10%;width:100%;background-color:white;">
        <button type="submit" id="signbutton" onclick="DownFile()">Sign In</button>
    </div>

    <div class="div2" id="ShowMain">
        <!--<div style="height:10%;width:100%;background-color:white;">-->
             <!--<button type="submit" id="signbutton">Sign In</button>-->
        <!--</div>-->
        <div class="container" id="navlist" style="height:4%;">
            {% for navi in navlist %}
                {% if navi.path == navlastpath %}
                    <div>
                        <a id={{navi.path}} style="color:#000000;font-size:15px;text-decoration:none;" href="javascript:void(0);" onclick="test(this)">&ensp;{{navi.navname}}</a>
                    </div>
                {% else %}
                    <div>
                        <a id={{navi.path}} style="color:#C0C0C0;font-size:15px;text-decoration:none;" href="javascript:void(0);" onclick="test(this)">&ensp;{{navi.navname}}</a>
                    </div>
                    <div>
                        <span id={{navi.path}}00 style="color:#C0C0C0;font-size:15px;">&ensp;&gt;</span>
                    </div>
                 {% endif %}
            {% endfor %}
        </div>
        <div style="border-bottom:1px solid #CCC"></div>
        <div class="container" style="height:2.9%;width:100%;">
            <label style="display:block;width:60%;height:100%;color:Gray;">文件名</label>
            <label style="display:block;width:15%;height:100%;color:Gray;">大小</label>
            <label style="display:block;width:25%;height:100%;color:Gray;">修改日期</label>
        </div>
        <div style="border-bottom:1px solid #CCC"></div>

        <div style="overflow:scroll;height:84.5%;width:100%;">
            <div id="FilesData">
                {% for filedata in data %}
                    <table width="100%" border="0" style="width:100%;">
                        <tr class="change">
                            <td style="width:100%;">
                                <div class="container">
                                    <div class="container" style="width:10%">
                                        <input name={{filedata.filelj}} type="checkbox" value="" />&nbsp;
                                        <img src={{filedata.imgpath}} width="50%">
                                    </div>
                                    <div style="width:50%;">
                                        <a id={{filedata.filelj}} style="color:black;font-size:20px;text-decoration:none;" href="javascript:void(0);" onclick="test(this)">
                                            {{filedata.filename}}
                                        </a>
                                    </div>
                                    <div style="width:15%;color:Gray;">
                                        <label>
                                            {{filedata.big}}
                                        </label>
                                    </div>
                                    <div style="width:25%;color:Gray;">
                                        <label>
                                            {{filedata.date}}
                                        </label>
                                    </div>

                                </div>
                            </td>
                        </tr>
                    </table>
                    <div style="border-bottom:1px solid #CCC"></div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>

<div style="display:none">
    <form action="/FileDown/" id="b" method="post">
        <input type="text" name="downinfo" id="downpaths">
        <button type="submit" id="downbuton"></button>
    </form>
</div>

<script>
    function DownFile()
    {

        var downfiles = FindCheckdown();
        if (downfiles == "网页版不支持文件夹上传/下载")
        {
            alert("网页版不支持文件夹上传/下载");
            return;
        }
        console.log(downfiles);
        for(var i=0;i<downfiles.length;i++)
        {
            cururl = 'http://'+window.location.host;
            urli = cururl+'/FileDown/?downinfo='+encodeURIComponent(JSON.stringify(downfiles[i]))
            var a = document.createElement('a');
            <!--var url = window.URL.createObjectURL(blob);-->
            var filename = downfiles[i].fename;
            a.href = urli;
            a.download = filename;
            a.click();
            a.remove();

            <!--document.getElementById("downpaths").value = JSON.stringify(downfiles[i]);-->
            <!--document.getElementById("downbuton").click();-->
        }
    }

    function FindCheckdown()
    {
        var files = {{data|safe}};
        var Res = [];
        for (var i=0;i<files.length;i++)
        {
            file = files[i].filelj;
            if (document.getElementsByName(file)[0].checked==true)
            {
                filename = files[i].filename;
                feisdir =files[i].isdir;
                if (feisdir == 1)
                    {
                        msg = "网页版不支持文件夹上传/下载"
                        return msg;
                    }
                 Res.push({'fename':filename,'fepath':file});
            }

        }
        return Res;
        <!--console.log(Res);-->
    }
</script>

<script>

    function test(act)
    {
        var encodeurl = encodeURIComponent(act.id)
        var cururl = 'http://'+window.location.host+'/test/';
        $("#ShowMain").load(cururl,{"ids": encodeurl});

        var stateObject = {};
        var title = "Wow Title";
        var newUrl = "/?path="+encodeurl;
        history.pushState(stateObject,title,newUrl);


<!--        $.ajax({-->
<!--        async: false,-->
<!--        type: "POST",-->
<!--        url: '/test/',-->
<!--        data: {"ids": act.id},-->
<!--        dataType: "json",-->
<!--        success: function () { },-->
<!--        error: function () { },-->
<!--        complete: function () {-->
<!--        $("#FilesData").load(cururl,datas);-->
<!--        }-->
<!--        })-->
    }
</script>

<script>
    function UpShow(act)
    {


        var cururl = 'http://'+window.location.host+'/test/';
        $("#ShowMain").load(cururl,{"ids": act.id});

        var stateObject = {};
        var title = "Wow Title";
        var newUrl = "/?path="+act.id;
        history.pushState(stateObject,title,newUrl);

        <!--var breadnavlist = {{navlist|safe}}-->
        <!--for(var i=0;i<breadnavlist.length;i++)-->
          <!--{-->
            <!--var breadnav = breadnavlist[i].path;-->
            <!--var actBv = document.getElementById(breadnav);-->
            <!--if(i == breadnav.length-1)-->
              <!--{-->
                <!--actBv.style.color = "#000000";-->
                <!--actBv.removeAttribute("href");-->
                <!--document.getElementById(breadnavlist[i].path+"00").innerHTML = "";-->
              <!--}-->
            <!--else-->
              <!--{-->
                <!--actBv.href = '?path='+breadnavlist[i].path;-->
              <!--}-->
          <!--}-->
    }
</script>
<script>

var NvaShow = function()
{
    var breadnavlist = {{navlist|safe}}
    var breadnav = breadnavlist[breadnavlist.length-1].path;
    var actBv = document.getElementById(breadnav);
    actBv.style.fontSize = "15px";
    actBv.style.color = "#000000";
    actBv.removeAttribute("href");
    document.getElementById(breadnav+"00").innerHTML = "";
}
<!--NvaShow();-->
</script>


</body>
</html>